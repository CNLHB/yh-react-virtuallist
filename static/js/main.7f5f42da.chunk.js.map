{"version":3,"sources":["components/superVirtualList.tsx","components/index.tsx","grandChild.tsx","superDemo.tsx","child.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["arrayResolve","value","isArrayFunc","notArrayFunc","Array","isArray","console","error","VirtualList","props","scrollDom","referItemHeight","renderNumber","children","rest","useState","width","height","top","left","scrollDomParams","setScrollDomParams","useEffect","current","rect","getBoundingClientRect","childrenWrapParams","setChildrenWrapParams","ref","useRef","wrapperToScrollDomDistance","useMemo","cache","val","reduce","prev","next","index","Object","values","mockHeight","setMockHeight","refData","cloneChildren","map","v","i","oprops","React","cloneElement","node","slice","renderChildren","setRenderChildren","useLayoutEffect","fill","forEach","x","y","viewPortY","setViewPortY","start","maxY","fn","timer","e","scroll","target","scrollTop","sum","sindex","some","remain","length","window","setTimeout","Y","unstable_batchedUpdates","addEventListener","removeEventListener","clearTimeout","className","style","display","position","transform","itemHeight","iNumber","Math","floor","mockArr","GrandChild","border","SuperDemo","random","Child","ref2","overflow","App","flexDirection","justifyContent","alignItems","padding","fontSize","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.7f5f42da.chunk.js","sourcesContent":["import React, {\r\n\tDOMAttributes,\r\n\tPropsWithChildren,\r\n\tReactElement,\r\n\tRefObject,\r\n\tuseEffect,\r\n\tuseLayoutEffect,\r\n\tuseMemo,\r\n\tuseRef,\r\n\tuseState,\r\n} from \"react\";\r\nimport { unstable_batchedUpdates } from \"react-dom\";\r\n\r\nfunction arrayResolve<R>(\r\n\tvalue: any,\r\n\tisArrayFunc: Function,\r\n\tnotArrayFunc: Function\r\n): R {\r\n\tif (Array.isArray(value)) {\r\n\t\treturn isArrayFunc(value);\r\n\t} else {\r\n\t\tconsole.error(\"you must pass array children \");\r\n\t\treturn notArrayFunc();\r\n\t}\r\n}\r\n\r\nexport interface VirtualListProps extends DOMAttributes<HTMLDivElement> {\r\n\tscrollDom: RefObject<HTMLDivElement>;\r\n\treferItemHeight: number;\r\n\trenderNumber: number;\r\n}\r\n\r\nexport function VirtualList(props: PropsWithChildren<VirtualListProps>) {\r\n\tconst {\r\n\t\tscrollDom,\r\n\t\treferItemHeight,\r\n\t\trenderNumber,\r\n\t\tchildren,\r\n\t\t...rest\r\n\t} = props;\r\n\r\n\tconst [scrollDomParams, setScrollDomParams] = useState({\r\n\t\twidth: 0,\r\n\t\theight: 0,\r\n\t\ttop: 0,\r\n\t\tleft: 0,\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tif (props.scrollDom.current) {\r\n\t\t\tconst rect = props.scrollDom.current.getBoundingClientRect();\r\n\t\t\tsetScrollDomParams({\r\n\t\t\t\twidth: rect.width,\r\n\t\t\t\theight: rect.height,\r\n\t\t\t\tleft: rect.left,\r\n\t\t\t\ttop: rect.top,\r\n\t\t\t});\r\n\t\t}\r\n\t}, [props.scrollDom]);\r\n\r\n\tconst [childrenWrapParams, setChildrenWrapParams] = useState({\r\n\t\twidth: 0,\r\n\t\theight: 0,\r\n\t\ttop: 0,\r\n\t\tleft: 0,\r\n\t});\r\n\r\n\tconst ref = useRef<HTMLDivElement>(null);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (ref.current) {\r\n\t\t\tconst rect = ref.current.getBoundingClientRect();\r\n\t\t\tsetChildrenWrapParams({\r\n\t\t\t\twidth: rect.width,\r\n\t\t\t\theight: rect.height,\r\n\t\t\t\tleft: rect.left,\r\n\t\t\t\ttop: rect.top,\r\n\t\t\t});\r\n\t\t}\r\n\t}, []);\r\n\r\n\tconst wrapperToScrollDomDistance = useMemo(() => {\r\n\t\treturn childrenWrapParams.top - scrollDomParams.top;\r\n\t}, [childrenWrapParams.top, scrollDomParams.top]);\r\n\r\n\t//为每个元素建立高度\r\n\tconst cache = useMemo(() => {\r\n\t\treturn arrayResolve<Record<number, number>>(\r\n\t\t\tprops.children,\r\n\t\t\t(val: any[]) => {\r\n\t\t\t\treturn val.reduce((prev, next, index) => {\r\n\t\t\t\t\tprev[index] = props.referItemHeight;\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t}, {});\r\n\t\t\t},\r\n\t\t\t() => {}\r\n\t\t);\r\n\t}, [props.children, props.referItemHeight]);\r\n\r\n\tconst [mockHeight, setMockHeight] = useState(() => {\r\n\t\treturn Object.values(cache).reduce((prev, next) => prev + next, 0);\r\n\t});\r\n\tuseEffect(() => {\r\n\t\tsetMockHeight(\r\n\t\t\tObject.values(cache).reduce((prev, next) => prev + next, 0)\r\n\t\t);\r\n\t}, [cache]);\r\n\r\n\tconst refData: Record<number, HTMLDivElement> = useMemo(() => {\r\n\t\treturn {};\r\n\t}, []);\r\n\r\n\tconst cloneChildren = useMemo(() => {\r\n\t\treturn arrayResolve<ReactElement[]>(\r\n\t\t\tprops.children,\r\n\t\t\t(val: ReactElement[]) => {\r\n\t\t\t\treturn val.map((v, i) => {\r\n\t\t\t\t\tconst oprops = v.props;\r\n\t\t\t\t\treturn React.cloneElement(v, {\r\n\t\t\t\t\t\t...oprops,\r\n\t\t\t\t\t\tref: (node: HTMLDivElement) => {\r\n\t\t\t\t\t\t\trefData[i] = node;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t() => []\r\n\t\t);\r\n\t}, [props.children, refData]);\r\n\r\n\tconst [renderChildren, setRenderChildren] = useState(\r\n\t\t//一开始，需要返回对应截取的元素\r\n\t\t() => {\r\n\t\t\treturn arrayResolve<ReactElement[]>(\r\n\t\t\t\tcloneChildren,\r\n\t\t\t\t(val: any[]) => val.slice(0, props.renderNumber),\r\n\t\t\t\t() => []\r\n\t\t\t);\r\n\t\t}\r\n\t);\r\n\r\n\t//初次返回，我们进行修正cache //初次渲染 0- props.renderNumber\r\n\tuseLayoutEffect(() => {\r\n\t\tif (\r\n\t\t\t//如果0存在，说明已经显示了，\r\n\t\t\trefData[0]\r\n\t\t) {\r\n\t\t\t//map rendernumber\r\n\t\t\tnew Array(props.renderNumber).fill(1).forEach((x, y) => {\r\n\t\t\t\tconst height =\r\n\t\t\t\t\trefData[y].getBoundingClientRect().height || cache[y];\r\n\t\t\t\tcache[y] = height;\r\n\t\t\t});\r\n\t\t}\r\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t}, []);\r\n\r\n\tconst [viewPortY, setViewPortY] = useState(0);\r\n\r\n\tconst current = useMemo(() => {\r\n\t\treturn {\r\n\t\t\t//以start为界。每次删除前面的，加入后面的，并且修正cache\r\n\t\t\tstart: props.renderNumber,\r\n\t\t};\r\n\t}, [props.renderNumber]);\r\n\r\n\tconst maxY = useMemo(() => {\r\n\t\t//最大值等于mock高减去一屏幕高度\r\n\t\treturn mockHeight - scrollDomParams.height;\r\n\t}, [mockHeight, scrollDomParams.height]);\r\n\tuseEffect(() => {\r\n\t\tlet fn: (e: Event) => void;\r\n\t\tlet timer: number;\r\n\t\tif (props.scrollDom.current) {\r\n\t\t\tfn = (e: Event) => {\r\n\t\t\t\tconst target = e.target as HTMLDivElement;\r\n\t\t\t\tconst scroll = target.scrollTop;\r\n\t\t\t\t//根据scroll的高度判断滚到第几个位置\r\n\t\t\t\tlet sum = 0;\r\n\t\t\t\tlet sindex = 0;\r\n\t\t\t\tObject.values(cache).some((v, i) => {\r\n\t\t\t\t\tsum = sum + v;\r\n\t\t\t\t\tif (sum > scroll) {\r\n\t\t\t\t\t\tsindex = i;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconst remain =\r\n\t\t\t\t\tprops.renderNumber + sindex > cloneChildren.length\r\n\t\t\t\t\t\t? cloneChildren.length\r\n\t\t\t\t\t\t: props.renderNumber + sindex;\r\n\r\n\t\t\t\tconst start = current.start;\r\n\t\t\t\tif (start < remain && start < cloneChildren.length) {\r\n\t\t\t\t\ttimer = window.setTimeout(() => {\r\n\t\t\t\t\t\tfor (let i = start; i < remain; i++) {\r\n\t\t\t\t\t\t\tif (refData[i]) {\r\n\t\t\t\t\t\t\t\tconst height =\r\n\t\t\t\t\t\t\t\t\trefData[i].getBoundingClientRect().height ||\r\n\t\t\t\t\t\t\t\t\tcache[i];\r\n\t\t\t\t\t\t\t\tcache[i] = height;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsetMockHeight(\r\n\t\t\t\t\t\t\tObject.values(cache).reduce(\r\n\t\t\t\t\t\t\t\t(prev, next) => prev + next,\r\n\t\t\t\t\t\t\t\t0\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tcurrent.start = remain;\r\n\t\t\t\t\t\t//删除start之前的dom\r\n\t\t\t\t\t\tfor (let i = 0; i < start; i++) {\r\n\t\t\t\t\t\t\tif (refData[i]) {\r\n\t\t\t\t\t\t\t\tdelete refData[i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet Y = scroll - wrapperToScrollDomDistance;\r\n\t\t\t\tif (Y < 0) {\r\n\t\t\t\t\tY = 0;\r\n\t\t\t\t\t//最后的scroll 需要减去一屏幕高度\r\n\t\t\t\t} else if (Y >= maxY) {\r\n\t\t\t\t\tY = maxY;\r\n\t\t\t\t}\r\n\t\t\t\tunstable_batchedUpdates(() => {\r\n\t\t\t\t\tsetRenderChildren(cloneChildren.slice(0 + sindex, remain));\r\n\t\t\t\t\tsetViewPortY(Y);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tprops.scrollDom.current.addEventListener(\"scroll\", fn);\r\n\t\t}\r\n\t\treturn () => {\r\n\t\t\tif (props.scrollDom.current) {\r\n\t\t\t\t//解绑非常重要，否则渲再次出现渲染会出严重问题\r\n\t\t\t\tprops.scrollDom.current.removeEventListener(\"scroll\", fn);\r\n\t\t\t}\r\n\t\t\twindow.clearTimeout(timer);\r\n\t\t};\r\n\t}, [\r\n\t\tcache,\r\n\t\tcloneChildren,\r\n\t\tcurrent,\r\n\t\tmaxY,\r\n\t\tprops.referItemHeight,\r\n\t\tprops.renderNumber,\r\n\t\tprops.scrollDom,\r\n\t\trefData,\r\n\t\twrapperToScrollDomDistance,\r\n\t]);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"yh-supervirtuallist\"\r\n\t\t\tstyle={{ display: \"flex\", position: \"relative\", width: \"100%\" }}\r\n\t\t\t{...rest}\r\n\t\t>\r\n\t\t\t<div style={{ height: mockHeight }}></div>\r\n\t\t\t<div\r\n\t\t\t\tref={ref}\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\ttransform: `translate3d(0px, ${viewPortY}px, 0px)`,\r\n\t\t\t\t\twidth: \"100%\",\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t{renderChildren}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default VirtualList;\r\n","import React, {\r\n\tDOMAttributes,\r\n\tPropsWithChildren,\r\n\tReactChildren,\r\n\tRefObject,\r\n\tuseEffect,\r\n\tuseMemo,\r\n\tuseRef,\r\n\tuseState,\r\n} from \"react\";\r\nimport { unstable_batchedUpdates } from \"react-dom\";\r\nimport SuperVirtualList from \"./superVirtualList\";\r\nexport { SuperVirtualList };\r\n\r\nfunction arrayResolve<R>(\r\n\tvalue: any,\r\n\tisArrayFunc: Function,\r\n\tnotArrayFunc: Function\r\n): R {\r\n\tif (Array.isArray(value)) {\r\n\t\treturn isArrayFunc(value);\r\n\t} else {\r\n\t\tconsole.error(\"you must pass array children \");\r\n\t\treturn notArrayFunc();\r\n\t}\r\n}\r\n\r\nexport interface VirtualListProps extends DOMAttributes<HTMLDivElement> {\r\n\t//滚动dom的ref\r\n\tscrollDom: RefObject<HTMLDivElement>;\r\n\t//每个元素的高度\r\n\titemHeight: number;\r\n\t//渲染出几个元素\r\n\trenderNumber: number;\r\n}\r\n\r\nexport function VirtualList(props: PropsWithChildren<VirtualListProps>) {\r\n\tconst { children, scrollDom, itemHeight, renderNumber, ...rest } = props;\r\n\r\n\tconst [scrollDomParams, setScrollDomParams] = useState({\r\n\t\twidth: 0,\r\n\t\theight: 0,\r\n\t\ttop: 0,\r\n\t\tleft: 0,\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tif (props.scrollDom.current) {\r\n\t\t\tconst rect = props.scrollDom.current.getBoundingClientRect();\r\n\t\t\tsetScrollDomParams({\r\n\t\t\t\twidth: rect.width,\r\n\t\t\t\theight: rect.height,\r\n\t\t\t\tleft: rect.left,\r\n\t\t\t\ttop: rect.top,\r\n\t\t\t});\r\n\t\t}\r\n\t}, [props.scrollDom]);\r\n\r\n\tconst [childrenWrapParams, setChildrenWrapParams] = useState({\r\n\t\twidth: 0,\r\n\t\theight: 0,\r\n\t\ttop: 0,\r\n\t\tleft: 0,\r\n\t});\r\n\r\n\tconst ref = useRef<HTMLDivElement>(null);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (ref.current) {\r\n\t\t\tconst rect = ref.current.getBoundingClientRect();\r\n\t\t\tsetChildrenWrapParams({\r\n\t\t\t\twidth: rect.width,\r\n\t\t\t\theight: rect.height,\r\n\t\t\t\tleft: rect.left,\r\n\t\t\t\ttop: rect.top,\r\n\t\t\t});\r\n\t\t}\r\n\t}, []);\r\n\r\n\tconst wrapperToScrollDomDistance = useMemo(() => {\r\n\t\treturn childrenWrapParams.top - scrollDomParams.top;\r\n\t}, [childrenWrapParams.top, scrollDomParams.top]);\r\n\r\n\tconst mockHeight = useMemo(() => {\r\n\t\treturn arrayResolve<number>(\r\n\t\t\tprops.children,\r\n\t\t\t(val: any[]) =>\r\n\t\t\t\tval.length * props.itemHeight - wrapperToScrollDomDistance,\r\n\t\t\t() => 0\r\n\t\t);\r\n\t}, [props.children, props.itemHeight, wrapperToScrollDomDistance]);\r\n\r\n\tconst [renderChildren, setRenderChildren] = useState(\r\n\t\t//一开始，需要返回对应截取的元素\r\n\t\t() => {\r\n\t\t\treturn arrayResolve<ReactChildren>(\r\n\t\t\t\tprops.children,\r\n\t\t\t\t(val: any[]) => val.slice(0, props.renderNumber),\r\n\t\t\t\t() => null\r\n\t\t\t);\r\n\t\t}\r\n\t);\r\n\r\n\tconst [viewPortY, setViewPortY] = useState(0);\r\n\r\n\tuseEffect(() => {\r\n\t\tlet fn: (e: Event) => void;\r\n\t\tif (props.scrollDom.current) {\r\n\t\t\tfn = (e: Event) => {\r\n\t\t\t\tconst target = e.target as HTMLDivElement;\r\n\t\t\t\tconst scroll = target.scrollTop;\r\n\t\t\t\tconst iNumber = Math.floor(scroll / props.itemHeight);\r\n\t\t\t\tlet Y = scroll - wrapperToScrollDomDistance;\r\n\t\t\t\tif (Y < 0) {\r\n\t\t\t\t\tY = 0;\r\n\t\t\t\t\t//最后的scroll 需要减去一屏幕高度\r\n\t\t\t\t} else if (Y >= mockHeight - scrollDomParams.height) {\r\n\t\t\t\t\tY = mockHeight - scrollDomParams.height;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tunstable_batchedUpdates(() => {\r\n\t\t\t\t\tsetRenderChildren(\r\n\t\t\t\t\t\tarrayResolve<ReactChildren>(\r\n\t\t\t\t\t\t\tprops.children,\r\n\t\t\t\t\t\t\t(val: any[]) =>\r\n\t\t\t\t\t\t\t\tval.slice(\r\n\t\t\t\t\t\t\t\t\t0 + iNumber,\r\n\t\t\t\t\t\t\t\t\tprops.renderNumber + iNumber\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t() => null\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\t\t\t\t\tsetViewPortY(Y);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tprops.scrollDom.current.addEventListener(\"scroll\", fn);\r\n\t\t}\r\n\t\treturn () => {\r\n\t\t\tif (props.scrollDom.current) {\r\n\t\t\t\t//解绑非常重要，否则渲再次出现渲染会出严重问题\r\n\t\t\t\tprops.scrollDom.current.removeEventListener(\"scroll\", fn);\r\n\t\t\t}\r\n\t\t};\r\n\t}, [\r\n\t\tmockHeight,\r\n\t\tprops.children,\r\n\t\tprops.itemHeight,\r\n\t\tprops.renderNumber,\r\n\t\tprops.scrollDom,\r\n\t\tscrollDomParams.height,\r\n\t\twrapperToScrollDomDistance,\r\n\t]);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"yh-virtuallist\"\r\n\t\t\tstyle={{ display: \"flex\", position: \"relative\", width: \"100%\" }}\r\n\t\t\t{...rest}\r\n\t\t>\r\n\t\t\t<div style={{ height: mockHeight }}></div>\r\n\t\t\t<div\r\n\t\t\t\tref={ref}\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\ttransform: `translate3d(0px, ${viewPortY}px, 0px)`,\r\n\t\t\t\t\twidth: \"100%\",\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t{renderChildren}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default VirtualList;\r\n","import React, { RefObject } from \"react\";\r\nimport VirtualList from \"./components\";\r\n\r\nconst mockArr = new Array(10000).fill(1).map((x, y) => y);\r\n\r\nfunction GrandChild(props: { scrollDom: RefObject<HTMLDivElement> }) {\r\n\treturn (\r\n\t\t<div>\r\n\t\t\tthis text in the current component\r\n\t\t\t<div>\r\n\t\t\t\t<VirtualList\r\n\t\t\t\t\trenderNumber={25}\r\n\t\t\t\t\titemHeight={30}\r\n\t\t\t\t\tscrollDom={props.scrollDom}\r\n\t\t\t\t>\r\n\t\t\t\t\t{mockArr.map((v, i) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\t\tborder: \"1px solid black\",\r\n\t\t\t\t\t\t\t\t\theight: \"30px\",\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tkey={i}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{v}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t})}\r\n\t\t\t\t</VirtualList>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default GrandChild;\r\n","import React, { RefObject } from \"react\";\r\nimport SuperVirtualList from \"./components/superVirtualList\";\r\n\r\nconst mockArr = new Array(10000).fill(1).map((x, y) => y);\r\n\r\nfunction SuperDemo(props: { scrollDom: RefObject<HTMLDivElement> }) {\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<div>\r\n\t\t\t\t<SuperVirtualList\r\n\t\t\t\t\tscrollDom={props.scrollDom}\r\n\t\t\t\t\treferItemHeight={25}\r\n\t\t\t\t\trenderNumber={30}\r\n\t\t\t\t>\r\n\t\t\t\t\t{mockArr.map((v, i) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\t\tborder: \"1px solid black\",\r\n\t\t\t\t\t\t\t\t\theight: `${Math.random() * 30 + 20}px`,\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tkey={i}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{v}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t})}\r\n\t\t\t\t</SuperVirtualList>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default SuperDemo;\r\n","import React, { useRef } from \"react\";\r\nimport GrandChild from \"./grandChild\";\r\nimport SuperDemo from \"./superDemo\";\r\n\r\nfunction Child() {\r\n\tconst ref = useRef<HTMLDivElement>(null);\r\n\tconst ref2 = useRef<HTMLDivElement>(null);\r\n\treturn (\r\n\t\t<div style={{ display: \"flex\" }}>\r\n\t\t\t<div\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\theight: \"500px\",\r\n\t\t\t\t\tborder: \"1px solid black\",\r\n\t\t\t\t\toverflow: \"auto\",\r\n\t\t\t\t}}\r\n\t\t\t\tref={ref}\r\n\t\t\t>\r\n\t\t\t\tchild use to mock scroll dom. this text in the scroll dom.\r\n\t\t\t\t<GrandChild scrollDom={ref}></GrandChild>\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\theight: \"500px\",\r\n\t\t\t\t\tborder: \"1px solid black\",\r\n\t\t\t\t\toverflow: \"auto\",\r\n\t\t\t\t}}\r\n\t\t\t\tref={ref2}\r\n\t\t\t>\r\n\t\t\t\tchild use to mock scroll dom. this text in the scroll dom.\r\n\t\t\t\t<SuperDemo scrollDom={ref2}></SuperDemo>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default Child;\r\n","import React from \"react\";\nimport Child from \"./child\";\n\nfunction App() {\n\treturn (\n\t\t<div\n\t\t\tstyle={{\n\t\t\t\tdisplay: \"flex\",\n\t\t\t\tflexDirection: \"column\",\n\t\t\t\tjustifyContent: \"center\",\n\t\t\t\talignItems: \"center\",\n\t\t\t}}\n\t\t>\n\t\t\t<div style={{ padding: \"10px\", fontSize: \"20px\" }}>Mock Title </div>\n\t\t\t<div style={{ padding: \"10px\", fontSize: \"20px\" }}>\n\t\t\t\tit mock have distance from the top\n\t\t\t</div>\n\t\t\t<Child></Child>\n\t\t</div>\n\t);\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);  \n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n}\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}